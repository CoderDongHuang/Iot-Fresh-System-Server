# 物联网生鲜品储运系统 - 系统架构说明

## 项目概述

本项目是一个基于Spring Boot的物联网管理系统，专注于生鲜品储运过程中的设备监控和数据管理。系统采用微服务架构思想，提供了完整的用户管理、设备监控、数据分析和系统配置功能。

## 技术栈

- **后端框架**: Spring Boot 3.2.0
- **数据库**: MySQL 8.0
- **数据访问**: Spring Data JPA
- **安全框架**: Spring Security + JWT
- **消息队列**: MQTT (用于设备通信)
- **缓存**: Redis
- **构建工具**: Maven
- **编程语言**: Java 17

## 项目结构

```
src/main/java/com/iot/fresh/
├── controller/           # 控制器层 - 处理HTTP请求
│   ├── AlarmController.java
│   ├── AuthController.java
│   ├── DashboardController.java
│   ├── DataController.java
│   ├── DeviceController.java
│   ├── DeviceDataController.java
│   ├── MqttController.java
│   ├── RealTimeMonitorController.java
│   ├── UserController.java
│   └── SystemController.java
├── dto/                 # 数据传输对象
│   ├── AlarmDto.java
│   ├── ApiResponse.java
│   ├── DeviceDataDto.java
│   ├── DeviceDto.java
│   ├── LoginRequest.java
│   ├── PaginatedResponse.java
│   └── UserDto.java
├── entity/              # 实体类 - 对应数据库表
│   ├── Alarm.java
│   ├── Device.java
│   ├── DeviceData.java
│   └── User.java
├── repository/          # 数据访问层
│   ├── AlarmRepository.java
│   ├── DeviceDataRepository.java
│   ├── DeviceRepository.java
│   └── UserRepository.java
├── service/             # 服务层接口
│   ├── AlarmService.java
│   ├── DataService.java
│   ├── DeviceService.java
│   └── UserService.java
├── service/impl/        # 服务层实现
│   ├── AlarmServiceImpl.java
│   ├── DataServiceImpl.java
│   ├── DeviceServiceImpl.java
│   └── UserServiceImpl.java
├── config/              # 配置类
│   ├── CorsConfig.java
│   ├── MqttConfig.java
│   ├── RedisConfig.java
│   └── SecurityConfig.java
├── security/            # 安全相关
│   ├── JwtAuthenticationFilter.java
│   └── JwtUtil.java
├── util/                # 工具类
│   ├── DateUtils.java
│   └── JwtUtil.java
└── IotFreshApplication.java
```

## 核心功能模块

### 1. 用户管理模块

#### 功能描述
- 用户注册、登录、登出
- 用户信息管理（查看、编辑）
- 密码修改
- 头像上传
- 权限管理

#### 主要组件
- **UserController**: 处理用户相关的HTTP请求
- **UserService/UserServiceImpl**: 用户业务逻辑处理
- **UserRepository**: 用户数据访问
- **User Entity**: 用户实体

### 2. 设备管理模块

#### 功能描述
- 设备注册、注销
- 设备状态监控
- 设备信息管理
- 设备分组管理

#### 主要组件
- **DeviceController**: 处理设备相关的HTTP请求
- **DeviceService/DeviceServiceImpl**: 设备业务逻辑处理
- **DeviceRepository**: 设备数据访问
- **Device Entity**: 设备实体

### 3. 数据监控模块

#### 功能描述
- 实时数据监控
- 历史数据查询
- 数据统计分析
- 数据可视化

#### 主要组件
- **DeviceDataController**: 处理设备数据相关的HTTP请求
- **RealTimeMonitorController**: 处理实时监控请求
- **DashboardController**: 处理仪表盘统计请求
- **DataService/DataServiceImpl**: 数据业务逻辑处理
- **DeviceDataRepository**: 设备数据访问
- **DeviceData Entity**: 设备数据实体

### 4. 报警管理模块

#### 功能描述
- 实时报警监控
- 报警记录管理
- 报警统计分析
- 报警通知

#### 主要组件
- **AlarmController**: 处理报警相关的HTTP请求
- **AlarmService/AlarmServiceImpl**: 报警业务逻辑处理
- **AlarmRepository**: 报警数据访问
- **Alarm Entity**: 报警实体

### 5. 系统管理模块

#### 功能描述
- 系统配置管理
- 安全设置
- 通知设置
- 备份设置
- 用户信息管理

#### 主要组件
- **SystemController**: 处理系统设置相关的HTTP请求
- **UserController**: 处理用户信息管理相关的HTTP请求

## 安全架构

### JWT身份验证流程
1. 用户通过用户名/密码登录
2. 服务器验证凭据并生成JWT令牌
3. 客户端在后续请求中携带JWT令牌
4. 服务器通过JwtAuthenticationFilter验证令牌有效性
5. 验证通过后处理业务逻辑

### 权限控制
- 使用Spring Security进行访问控制
- 配置端点级别的权限
- 支持角色基础的访问控制(RBAC)

## 数据流

### 设备数据采集流程
```
IoT Devices → MQTT Broker → MqttController → DeviceDataRepository → Database
```

### 用户请求处理流程
```
HTTP Request → Security Filter → Controller → Service → Repository → Database
                                              ↓
                                    Response ← DTO ← JSON
```

### 实时监控流程
```
WebSocket Connection → RealTimeMonitorController → DeviceDataRepository → Client
```

## API设计原则

### 统一响应格式
```json
{
  "code": 200,
  "msg": "success",
  "data": {},
  "success": true
}
```

### RESTful API设计
- 使用名词而非动词
- 使用HTTP方法表示操作类型
- 使用复数形式的资源名称
- 使用嵌套结构表示资源关系

### URL路径规范
- `/api/v1/` - API版本控制
- `/api/user/` - 用户相关资源
- `/api/device/` - 设备相关资源
- `/api/dashboard/` - 仪表盘相关资源
- `/api/system/` - 系统设置相关资源

## 配置管理

### 应用配置 (application.yml)
- 数据库连接配置
- Redis连接配置
- MQTT配置
- JWT配置
- 服务器配置

### 环境分离
- 开发环境 (dev)
- 测试环境 (test)
- 生产环境 (prod)

## 扩展性考虑

### 微服务准备
- 模块化设计便于拆分
- 独立的数据访问层
- 清晰的API边界

### 水平扩展
- 无状态设计
- Redis集中缓存
- 数据库读写分离支持

### 监控和日志
- 统一的日志格式
- 关键操作审计
- 性能监控指标

## 部署架构

### 基础部署
```
Client Applications ↔ Application Server ↔ Database & Cache
```

### 高可用部署
```
Load Balancer
    ↓
Multiple Application Servers
    ↓
Shared Database Cluster & Redis Cluster
```

## 最佳实践

### 代码质量
- 统一的代码风格
- 详尽的注释文档
- 异常处理机制
- 输入验证

### 数据库设计
- 规范化的表结构
- 合适的索引策略
- 数据一致性保证
- 性能优化查询

### 安全措施
- SQL注入防护
- XSS攻击防护
- CSRF攻击防护
- 敏感数据加密

## 总结

本系统采用现代化的技术栈和架构模式，具有良好的扩展性、安全性和可维护性。通过模块化的设计，各个功能组件之间松耦合，便于独立开发和维护。系统具备完整的用户管理、设备监控、数据分析和系统配置功能，满足物联网生鲜品储运场景的需求。