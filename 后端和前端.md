## 1. 技术栈选择

### 核心框架

- **Spring Boot 3.x** - 作为基础框架
- **Spring Security** - 安全认证
- **Spring Data JPA** - 数据访问层
- **MyBatis** - SQL映射（可选，根据复杂度选择）

### 数据库

- **MySQL 8.0+** - 主数据库
- **Redis** - 缓存和会话存储
- **InfluxDB** - 时序数据存储（用于设备数据）

### 消息队列

- **RabbitMQ/Kafka** - 设备数据处理

### 其他组件

- **WebSocket** - 实时数据推送
- **JWT** - 无状态认证
- **Swagger/OpenAPI** - API文档

## 2. 项目结构建议

```
iot-backend/
├── src/main/java/com/iot/fresh/
│   ├── IotFreshApplication.java
│   ├── config/                 # 配置
类
│   │   ├── SecurityConfig.java
│   │   ├── WebSocketConfig.java
│   │   ├── CorsConfig.java
│   │   └── RedisConfig.java
│   ├── controller/             # 控制
器层
│   │   ├── AuthController.java
│   │   ├── DashboardController.java
│   │   ├── DeviceController.java
│   │   ├── DataController.java
│   │   ├── AlarmController.java
│   │   └── UserController.java
│   ├── service/                # 服务
层
│   │   ├── impl/               # 实现
类
│   │   ├── AuthService.java
│   │   ├── DashboardService.java
│   │   ├── DeviceService.java
│   │   ├── DataService.java
│   │   └── AlarmService.java
│   ├── repository/             # 数据
访问层
│   │   ├── DeviceRepository.java
│   │   ├── UserRepository.java
│   │   └── AlarmRepository.java
│   ├── entity/                 # 实体
类
│   │   ├── Device.java
│   │   ├── DeviceData.java
│   │   ├── User.java
│   │   └── Alarm.java
│   ├── dto/                    # 数据
传输对象
│   │   ├── LoginRequest.java
│   │   ├── DeviceDataDto.java
│   │   └── ApiResponse.java
│   ├── websocket/              # 
WebSocket相关
│   │   ├── DeviceWebSocket.java
│   │   └── WebSocketEndpoint.java
│   └── util/                   # 工具
类
│       ├── JwtUtil.java
│       ├── RedisUtil.java
│       └── DateUtil.java
├── src/main/resources/
│   ├── application.yml
│   ├── application-dev.yml
│   └── application-prod.yml
└── pom.xml
```

## 3. 数据库设计建议

### 用户表 (users)

```
CREATE TABLE users (
    id BIGINT PRIMARY KEY 
    AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT 
    NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    phone VARCHAR(20),
    role VARCHAR(20) DEFAULT 'USER',
    status TINYINT DEFAULT 1,
    created_at TIMESTAMP DEFAULT 
    CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT 
    CURRENT_TIMESTAMP ON UPDATE 
    CURRENT_TIMESTAMP
);
```

### 设备表 (devices)

```
CREATE TABLE devices (
    id BIGINT PRIMARY KEY 
    AUTO_INCREMENT,
    vid VARCHAR(50) UNIQUE NOT NULL,
    device_name VARCHAR(100),
    device_type VARCHAR(50),
    status TINYINT DEFAULT 0, -- 0:离
    线, 1:在线, 2:故障, 3:维护
    location VARCHAR(200),
    contact_phone VARCHAR(20),
    description TEXT,
    last_heartbeat TIMESTAMP,
    created_at TIMESTAMP DEFAULT 
    CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT 
    CURRENT_TIMESTAMP ON UPDATE 
    CURRENT_TIMESTAMP
);
```

### 设备数据表 (device_data) - 使用时序数据库

```
-- 用于存储设备实时数据，建议使用InfluxDB
-- measurement: device_data
-- tags: vid, device_type
-- fields: tin, tout, lxin, 
brightness, speed_m1, speed_m2, 
v_status
-- time: timestamp
```

### 报警表 (alarms)

```
CREATE TABLE alarms (
    id BIGINT PRIMARY KEY 
    AUTO_INCREMENT,
    device_id BIGINT,
    device_name VARCHAR(100),
    alarm_type VARCHAR(50), -- 温度异
    常, 湿度异常, 设备故障
    alarm_level VARCHAR(20), -- high, 
    medium, low
    message TEXT,
    status VARCHAR(20) DEFAULT 
    'active', -- active, resolved, 
    closed
    created_at TIMESTAMP DEFAULT 
    CURRENT_TIMESTAMP,
    resolved_at TIMESTAMP NULL,
    FOREIGN KEY (device_id) REFERENCES 
    devices(id)
);
```

## 4. 核心功能实现建议

### 4.1 设备数据实时处理

```
// WebSocket实时数据推送
@ServerEndpoint("/websocket/device/
{vid}")
@Component
public class DeviceWebSocket {
    @OnMessage
    public void onMessage(String 
    message, @PathParam("vid") String 
    vid, Session session) {
        // 处理设备发送的数据
        // 存储到数据库
        // 推送给前端
    }
}
```

### 4.2 数据存储策略

- **设备实时数据**：使用InfluxDB存储，支持高效的时间序列查询
- **设备信息**：使用MySQL存储
- **报警信息**：使用MySQL存储
- **用户信息**：使用MySQL存储

### 4.3 缓存策略

```
@Service
public class DeviceService {
    @Cacheable(value = "devices", key 
    = "#vid")
    public Device getDeviceByVid
    (String vid) {
        return deviceRepository.
        findByVid(vid);
    }
}
```

## 5. API设计建议

### 认证API

```
POST /api/auth/login - 用户登录
POST /api/auth/logout - 用户登出
GET /api/auth/info - 获取用户信息
```

### 设备API

```
GET /api/devices - 获取设备列表
GET /api/devices/{vid} - 获取设备详情
GET /api/devices/{vid}/real-time - 获取
设备实时数据
GET /api/devices/{vid}/history - 获取设
备历史数据
POST /api/devices/{vid}/control - 控制
设备
```

### 仪表盘API

```
GET /api/dashboard/statistics - 获取仪表
盘统计信息
GET /api/dashboard/devices/status - 获
取设备状态分布
```

### 数据API

```
GET /api/data/history - 获取历史数据
GET /api/data/temperature/{vid} - 获取
温度历史数据
GET /api/data/export - 导出数据
```

### 报警API

```
GET /api/alarms - 获取报警列表
POST /api/alarms/{id}/handle - 处理报警
GET /api/alarms/settings - 获取报警设置
POST /api/alarms/settings - 更新报警设置
```

## 6. 性能优化建议

### 6.1 数据库优化

- 为经常查询的字段建立索引
- 使用分页查询避免大数据量加载
- 考虑读写分离

### 6.2 缓存策略

- 使用Redis缓存热点数据
- 实现多级缓存策略
- 合理设置缓存过期时间

### 6.3 消息队列

- 使用RabbitMQ处理设备数据异步存储
- 实现报警消息的异步处理

## 7. 安全考虑

### 7.1 认证授权

- 使用JWT实现无状态认证
- 实现RBAC权限控制
- 设置API访问频率限制

### 7.2 数据安全

- 敏感数据加密存储
- 实现数据访问审计
- 使用HTTPS传输

## 8. 部署建议

### 8.1 容器化部署

```
FROM openjdk:17-jdk-slim
COPY target/iot-fresh-backend.jar app.
jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### 8.2 监控和日志

- 集成Spring Boot Actuator
- 使用ELK Stack进行日志分析
- 配置Prometheus + Grafana进行监控

## 9. 微服务架构建议（可选）

如果系统规模较大，可以考虑微服务架构：

- **认证服务** - 处理用户认证
- **设备服务** - 管理设备信息
- **数据服务** - 处理设备数据
- **报警服务** - 处理报警逻辑
- **网关服务** - API网关

## 10. 第三方集成

- **设备通信** - MQTT协议支持
- **消息推送** - 集成推送服务
- **报表服务** - 集成报表生成工具

这个架构设计充分考虑了物联网系统的特殊需求，包括实时数据处理、大量设备连接、数据存储优化等方面，能够很好地支撑前端应用的完整功能。